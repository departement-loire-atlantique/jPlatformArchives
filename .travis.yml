env:
  global:
  - secure: b+zvXH62m0y7FS1jePqehkEgyD2tB1SFgL05pTgqoI7JMOErLWjHGxLjwjzbpvst7GYzo5zc+qJTyXihEoMlGUi2zWMUiW3vJaA7vKp2cG+N87A4zYps4XXjr9p7/WybXurSfOhc7CNeIrg7HLbpL9rFGvi0pUl31gd1RwvGRFkwlvzBghKv1R3XIbE9HzJk2PTY7nvJJ2y4gNNDHXgprKeoGZ6aP/q+s9UKINBkL3f6vA+oIJ3e1sakQXa3V4/WZKcIH3ch22s4OBKxMB/fGuCY3Uyy49lJL8+2eEkQyBxWvgalQGkpCdNh4N2AXHe5FDTME3azzCoSlwBPk5O7IArh5xq60Y4BSssV86yovlaU2Vlsm5w2hWmjLtj6hTTu0eCUzSQSjvharV+AMWFNQxcWtTJLHpXUlTVE2BayRAOOAAaaQGZhJX9P6pADFYG+hfTj5wpVME1Od5rhj5SxNHQXap9dhOTmF2n7e1ULHaMNPHdmg2zgoN/fv4bL+rZUIWXEASXnPYNBKipkKRrExYKBWAkd4y8Zx3GTQ6n3L+K1XHpzfrFGWiMeufJriX/dxK55s8m05pwjotdj13LcK2gWUcZURT0EFdYIiUKo8F308Pf6TIZAI6vxZeQlaWvMciwsVJPrgN/ZerafmQrG1rf92iv9pEZVK/qbGh6VWEw=
  - secure: ZO+1RwQD4zDBoEF2OnpnBuVMmmXC7Q2s07wr+grqWHqyKW2hzPOXl1pHPgfRYLcq7k5uRrwbqhb59R3JhLkKCiYCrP088Bf2pxbOwmgsKa11pqAqAYJ0hdFHFBYxdUx3YvNWcNyFNq6qldPUHyAffeNsPSJN3b0VwDejnxiV5zTZHiUpNwnkf2OmWTBheJLt6nxLIN++KUkN7lQ5/O+RS5tqBVSUypdxxR1lT7KmyJR5L26SVaC8BdfnoH664hPafjWNb2smHROlLVAopkLegfFb7QlnV1g4Q5cEhvzcJU2CqxWpcOYjkJymTifhV3egwqpkKhS6cn91xnncpjTaMgPLOPk0RpJGfKL3pa7qi2PhI3HaRaVPsIxsc076cn15vx0+2KxRPeFNZsmCZsOZyqabWg0Xzkv8/Ch3i7I8jMUWn1yhqO6Ih8KTviOTHsWNpzTMZpRW1bCIqyWetbZe0+bsHJbjgRj0pFFn+7a/jeQK6Cdu86TNufrYEBSIHUk9NATy/MSEZ9AOpphfPy7jhWksAZyqLiXbtXkQsUz3F7RpYdkBtmq/fXeUiPlmq3gfegs/TVaQNdfqy9G28v3su/56c2tX7KstZL65Kn2CVTnbNMy3ym01K+dL61QCcglhslqk7i3dbR/h5oU1zYpkxOrBmQAYQSyHM+NYt2WQPTg=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantiqu-1
    token:
      secure: jh8hhw8nYWGmUnSrLCKX/UG6rqPCAPagUF4N3p9InOtjz2TcDk6d2FAAp/I7qXg3QeY5F2Nlul4SSWuzeapZ8OGA0U4Tc+uMZUihM4RJGv/7COsWFconAztFxdn6/MVg8kXQSi1CHUGwOC2+nSSp5AIAwRrpEw498DkD1e+A2+nlge7jFCCWQeKCD+9s09psX5fLDeu1jKX+JpX/kBD4F2ayYeLdj8siugHUdWeQWJgBRC44ah94+IRJ8Bw8yYHXqwVg03fjwHXGqJ+5iYNJboBJXQET5tZTPV9Jyu+jh035ZX4ZdP1WCLHWrL0PyR1R5yIztQzvDNCFx7wpfDXDzfqJUxJzcSytQV864qwMVq1qfyDNGmVrVh12aq8l65jrS/R3BhroFEdHlrmYk0ruvd6bnbC0HMT+YEvmDXTPEwmV+ca2unLlaR4oBqzy/em/Ww8wkRM2TE9sbjddNBZBX4faq/3tz6ycXMsirMnobxsPLFcF3jWNqSNVikKnxejmiZAM4zLEu6XV/2J7Nm87zfnTiQ+9Y/9BOaxeoU9cVdGKYmq9P5TPMChwm5/ZMQTULfR5lKs+amql+JmDB8h2VooRlx1KKq8A92ZpPV5Va9+mI8fpM0X6ToPBF2wcfATzZzxTlQXsALbe25oSSjY+R7+I3eSbC6Dc3ET+0/9/4QA=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull sguellec/jplatformbuild

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t sguellec/jplatformbuild
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: h348SHdaGHCEQCAlY/C/f3JH8FBWFn9M0JdW4zAl6BgYoRzm8dPmr2hAzJdeMtLKWU/Y/sGXXwlT25SHpKs7tWDwu7b/9ON4WeDLvX2NXdDtqJDaOmXxqdC9/SaZGmpdTl1vDqZBLl+e9lH6UZDm20l+I/4Wz7kkAD6Cxprjani9N4fgLQNrt9srMQU1sRnsUWS5/sz+JdqnNzGuWxhykFHEFljONAF1YZDwZ0KOA8GAszcOc4Gj7i/xqQWwrxPRD2xIpoCLj9pvyFZMHRk2ZLoZA2TlvG3RLM//3MwWSY9RE9imBeZmnarXeCfyA2IEHCpaJjoXPVTiWlRRFg5OswHwXwvqyILdtIYai0oG5Grrmv38irQqVb18psw4xmkjIhckrl/frwONtgFtHTz88LajNjoYUqfhKFcoECc0ifCWN21M86m0GwhBab0YFhCo8jk/3utDEoUkHgXYiiSQFyvOGzhTUCQBrSHfoL9FH1JwTOAxYg61AsilB1+F/2DajLorjgGZXfTlRGuiUf5mFVmmtBH4f+4LbPy5yId35yEYsX1oRdk681NZj7pj/nVNrwkZNhQoOZv5bi46KJm57E6TjSUodHCF/ux2A0SnDRkw7D8HNLs0eBQn0zP73GnkTpbRsS/F1zAW0v3uptG8imfFuFOLgP8SMEG6pZpbM7o=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
